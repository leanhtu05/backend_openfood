<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}OpenFood Admin{% endblock %}</title>
    
    <!-- üöÄ CRITICAL PERFORMANCE OPTIMIZATIONS -->
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    
    <!-- Preload critical CSS -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"></noscript>
    
    <!-- Critical inline CSS for immediate rendering -->
    <style>
        /* üöÄ Critical CSS - Inline for fastest rendering */
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Fast sidebar styles */
        .sidebar { min-height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: none; }
        .sidebar .nav-link { color: rgba(255,255,255,0.8); padding: 10px 15px; transition: background-color 0.2s ease; }
        .sidebar .nav-link:hover, .sidebar .nav-link.active { background-color: rgba(255,255,255,0.2); color: white; }
        .main-content { background-color: #f8f9fa; min-height: 100vh; }
        
        /* Fast card styles */
        .card { border: none; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 1rem; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .stat-card-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        .stat-card-warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; }
        .stat-card-info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; }
        
        /* Fast table styles */
        .table-responsive { border-radius: 10px; overflow: hidden; }
        .table th { background-color: #f8f9fa; border-top: none; font-weight: 600; }
        
        /* Fast button styles */
        .btn { border-radius: 6px; font-weight: 500; transition: all 0.2s ease; }
        .btn:hover { transform: translateY(-1px); }
        
        /* Fast form styles */
        .form-control { border-radius: 6px; border: 1px solid #ddd; transition: border-color 0.2s ease; }
        .form-control:focus { border-color: #667eea; box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25); }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- üöÄ Loading overlay for page transitions -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <div style="margin-top: 10px; color: #666;">ƒêang t·∫£i...</div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- üöÄ Optimized Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h5 class="text-white">
                            <i class="fas fa-utensils"></i>
                            OpenFood Admin
                        </h5>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link {% if request.url.path == '/admin' or request.url.path == '/admin/' %}active{% endif %}" 
                               href="/admin" data-page="dashboard">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if '/admin/foods' in request.url.path %}active{% endif %}" 
                               href="/admin/foods" data-page="foods">
                                <i class="fas fa-utensils"></i>
                                M√≥n ƒÉn
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if '/admin/users' in request.url.path %}active{% endif %}" 
                               href="/admin/users" data-page="users">
                                <i class="fas fa-users"></i>
                                Ng∆∞·ªùi d√πng
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if '/admin/meal-plans' in request.url.path %}active{% endif %}" 
                               href="/admin/meal-plans" data-page="meal-plans">
                                <i class="fas fa-calendar-alt"></i>
                                K·∫ø ho·∫°ch
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if '/admin/reports' in request.url.path %}active{% endif %}" 
                               href="/admin/reports" data-page="reports">
                                <i class="fas fa-chart-bar"></i>
                                B√°o c√°o
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if '/admin/settings' in request.url.path %}active{% endif %}" 
                               href="/admin/settings" data-page="settings">
                                <i class="fas fa-cog"></i>
                                C√†i ƒë·∫∑t
                            </a>
                        </li>
                        <hr class="text-white-50">
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <i class="fas fa-home"></i>
                                Trang ch·ªß
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-warning" href="/admin/logout" 
                               onclick="return confirm('ƒêƒÉng xu·∫•t?')">
                                <i class="fas fa-sign-out-alt"></i>
                                ƒêƒÉng xu·∫•t
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- üöÄ Optimized Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h3">{% block page_title %}Dashboard{% endblock %}</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        {% block page_actions %}{% endblock %}
                    </div>
                </div>

                <!-- üöÄ Content with lazy loading -->
                <div id="mainContent">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>

    <!-- üöÄ OPTIMIZED JAVASCRIPT LOADING -->
    <!-- Load FontAwesome asynchronously after page load -->
    <script>
        // Load FontAwesome after page load
        window.addEventListener('load', function() {
            const faLink = document.createElement('link');
            faLink.rel = 'stylesheet';
            faLink.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
            document.head.appendChild(faLink);
        });
    </script>
    
    <!-- Load Bootstrap JS asynchronously -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    
    <!-- üöÄ Performance optimized admin script -->
    <script>
        // Fast page transitions
        document.addEventListener('DOMContentLoaded', function() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Add click handlers to navigation links
            const navLinks = document.querySelectorAll('a[data-page]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    // Show loading overlay
                    loadingOverlay.style.display = 'flex';
                    
                    // Hide overlay after 5 seconds (fallback)
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 5000);
                });
            });
            
            // Fast form submissions
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang x·ª≠ l√Ω...';
                    }
                });
            });
            
            // Auto-hide alerts
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                setTimeout(() => {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(() => {
                        if (alert.parentNode) {
                            alert.parentNode.removeChild(alert);
                        }
                    }, 500);
                }, 5000);
            });
            
            // Performance monitoring
            const loadTime = performance.now();
            console.log(`üöÄ Admin page loaded in ${Math.round(loadTime)}ms`);
        });
        
        // Fast refresh function
        function fastRefresh() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = 'flex';
            setTimeout(() => {
                location.reload();
            }, 300);
        }
        
        // Fast navigation function
        function fastNavigate(url) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = 'flex';
            setTimeout(() => {
                window.location.href = url;
            }, 200);
        }
    </script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
